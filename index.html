<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudyFlip - Flashcard Ã”n Táº­p</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --primary:#6C63FF;--primary-dark:#5a52d5;--secondary:#FF6584;
  --success:#43D9A2;--warning:#FFB347;--danger:#FF6B6B;
  --bg:#F0F2FF;--white:#fff;--gray:#6b7280;--text:#1e2a3a;
  --border:#e0e3f0;--shadow:0 4px 24px rgba(108,99,255,.13);
}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

/* HEADER */
header{background:linear-gradient(135deg,var(--primary),#a78bfa);padding:0 28px;height:62px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 16px rgba(108,99,255,.25)}
.logo{font-size:1.45rem;font-weight:800;color:#fff;letter-spacing:-.5px}
.logo span{color:#ffd6e0}
.header-btns{display:flex;gap:8px}
.btn{padding:8px 18px;border-radius:9px;border:none;cursor:pointer;font-size:.88rem;font-weight:700;transition:all .2s}
.btn-white{background:#fff;color:var(--primary)}
.btn-white:hover{background:#f0f0ff}
.btn-outline-white{background:transparent;border:2px solid rgba(255,255,255,.7);color:#fff}
.btn-outline-white:hover{background:rgba(255,255,255,.15)}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-success{background:var(--success);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-warning{background:var(--warning);color:#fff}
.btn-sm{padding:6px 13px;font-size:.8rem}
.btn-gray{background:#f3f4f6;color:var(--gray)}
.btn-gray:hover{background:#e5e7eb}

/* CONTAINER */
.container{max-width:1000px;margin:0 auto;padding:28px 20px}

/* VIEWS */
.view{display:none}
.view.active{display:block}

/* HOME */
.home-hero{text-align:center;padding:40px 20px 32px}
.home-hero h1{font-size:2rem;font-weight:800;margin-bottom:10px}
.home-hero h1 span{color:var(--primary)}
.home-hero p{color:var(--gray);margin-bottom:28px}
.stats-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:32px}
.stat-card{background:var(--white);border-radius:14px;padding:18px;text-align:center;box-shadow:var(--shadow)}
.stat-card .num{font-size:1.9rem;font-weight:800;color:var(--primary)}
.stat-card .lbl{font-size:.8rem;color:var(--gray);font-weight:600}
.decks-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.decks-header h2{font-size:1.1rem;font-weight:800}
.decks-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.deck-card{background:var(--white);border-radius:16px;padding:22px;box-shadow:var(--shadow);cursor:pointer;transition:transform .2s,box-shadow .2s;position:relative;overflow:hidden}
.deck-card:hover{transform:translateY(-4px);box-shadow:0 8px 32px rgba(108,99,255,.18)}
.deck-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;background:var(--deck-color,var(--primary))}
.deck-icon{font-size:2rem;margin-bottom:10px}
.deck-name{font-size:1rem;font-weight:700;margin-bottom:4px}
.deck-meta{font-size:.8rem;color:var(--gray)}
.deck-progress{margin-top:12px;background:#f0f0ff;border-radius:10px;height:6px;overflow:hidden}
.deck-progress-bar{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--primary),#a78bfa);transition:width .4s}
.deck-actions{display:flex;gap:6px;margin-top:14px}
.empty-state{text-align:center;padding:60px 20px;color:var(--gray)}
.empty-state .big{font-size:3rem;margin-bottom:12px}

/* MODAL */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:500;display:flex;align-items:center;justify-content:center;padding:20px}
.modal{background:var(--white);border-radius:20px;padding:32px;width:100%;max-width:460px;animation:pop .25s;max-height:90vh;overflow-y:auto}
@keyframes pop{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.modal h3{font-size:1.2rem;font-weight:800;margin-bottom:20px}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:.85rem;font-weight:700;margin-bottom:6px;color:var(--gray)}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:10px 14px;border-radius:9px;border:1.5px solid var(--border);font-size:.92rem;outline:none;transition:border .2s;font-family:inherit}
.form-group input:focus,.form-group textarea:focus{border-color:var(--primary)}
.form-group textarea{height:90px;resize:vertical}
.color-picker{display:flex;gap:8px;flex-wrap:wrap}
.cp{width:32px;height:32px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:transform .15s}
.cp:hover,.cp.active{transform:scale(1.2);border-color:#333}
.modal-btns{display:flex;gap:10px;margin-top:20px}
.modal-btns .btn{flex:1}

/* FLASHCARD STUDY */
.study-header{display:flex;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap}
.study-header h2{font-size:1.1rem;font-weight:800;flex:1}
.progress-wrap{width:100%;background:#e0e3f0;border-radius:10px;height:8px;margin-bottom:24px;overflow:hidden}
.progress-fill{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--primary),#a78bfa);transition:width .4s}
.card-counter{font-size:.85rem;color:var(--gray);font-weight:600}

/* FLIP CARD */
.flip-scene{width:100%;max-width:600px;height:320px;margin:0 auto 28px;perspective:1000px;cursor:pointer}
.flip-card{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .55s cubic-bezier(.4,0,.2,1)}
.flip-card.flipped{transform:rotateY(180deg)}
.flip-face{position:absolute;inset:0;border-radius:24px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;backface-visibility:hidden;box-shadow:var(--shadow)}
.flip-front{background:linear-gradient(135deg,var(--primary),#a78bfa);color:#fff}
.flip-back{background:var(--white);transform:rotateY(180deg);border:2.5px solid var(--border)}
.flip-label{font-size:.75rem;font-weight:700;opacity:.7;text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px}
.flip-text{font-size:1.25rem;font-weight:700;text-align:center;line-height:1.5}
.flip-hint{font-size:.8rem;opacity:.6;margin-top:16px}
.flip-back .flip-text{color:var(--text)}

/* RATING BTNS */
.rating-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.rate-btn{padding:12px 28px;border-radius:12px;border:none;cursor:pointer;font-size:.95rem;font-weight:700;transition:all .2s;display:flex;flex-direction:column;align-items:center;gap:3px}
.rate-btn small{font-size:.72rem;opacity:.8;font-weight:500}
.rate-btn:hover{transform:translateY(-2px);filter:brightness(1.08)}
.rate-easy{background:var(--success);color:#fff}
.rate-medium{background:var(--warning);color:#fff}
.rate-hard{background:var(--danger);color:#fff}
.study-actions{display:flex;gap:10px;justify-content:center;margin-top:20px}

/* RESULT */
.result-wrap{text-align:center;padding:20px}
.result-emoji{font-size:4rem;margin-bottom:12px}
.result-wrap h2{font-size:1.6rem;font-weight:800;margin-bottom:8px}
.result-wrap p{color:var(--gray);margin-bottom:24px}
.result-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:28px}
.rs{background:var(--bg);border-radius:12px;padding:16px;text-align:center}
.rs .n{font-size:1.6rem;font-weight:800}
.rs .l{font-size:.78rem;color:var(--gray);font-weight:600}
.rs.easy .n{color:var(--success)}
.rs.med .n{color:var(--warning)}
.rs.hard .n{color:var(--danger)}

/* MANAGE CARDS */
.cards-list{display:flex;flex-direction:column;gap:10px;margin-top:16px}
.card-item{background:var(--white);border-radius:12px;padding:14px 18px;display:flex;align-items:center;gap:14px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.card-item .ci-q{flex:1;font-weight:600;font-size:.92rem}
.card-item .ci-a{flex:1;font-size:.85rem;color:var(--gray)}
.ci-badge{padding:3px 10px;border-radius:20px;font-size:.72rem;font-weight:700}
.badge-easy{background:#d1fae5;color:#065f46}
.badge-medium{background:#fef3c7;color:#92400e}
.badge-hard{background:#fee2e2;color:#991b1b}
.badge-new{background:#ede9fe;color:#5b21b6}

/* SEARCH */
.search-wrap{position:relative;margin-bottom:16px}
.search-wrap input{width:100%;padding:10px 14px 10px 38px;border-radius:10px;border:1.5px solid var(--border);font-size:.9rem;outline:none}
.search-wrap input:focus{border-color:var(--primary)}
.search-wrap .ico{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:1rem;color:var(--gray)}

/* QUIZ MODE */
.quiz-option{width:100%;padding:14px 18px;border-radius:12px;border:2px solid var(--border);background:var(--white);text-align:left;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s;margin-bottom:10px}
.quiz-option:hover{border-color:var(--primary);background:#f5f3ff}
.quiz-option.correct{border-color:var(--success);background:#d1fae5;color:#065f46}
.quiz-option.wrong{border-color:var(--danger);background:#fee2e2;color:#991b1b}
.quiz-score{font-size:1.1rem;font-weight:700;color:var(--primary);text-align:center;margin-bottom:16px}

@media(max-width:500px){
  .flip-scene{height:260px}
  .flip-text{font-size:1.05rem}
  .rating-btns{gap:8px}
  .rate-btn{padding:10px 18px}
  .stats-bar{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<header>
  <div class="logo">Study<span>Flip</span> ğŸƒ</div>
  <div class="header-btns">
    <button class="btn btn-outline-white btn-sm" onclick="showView('home')">ğŸ  Trang chá»§</button>
    <button class="btn btn-white btn-sm" onclick="openGuide()">ğŸ“– HÆ°á»›ng dáº«n</button>
  </div>
</header>

<!-- MODAL HÆ¯á»šNG DáºªN -->
<div class="overlay" id="overlayGuide" style="display:none">
  <div class="modal" style="max-width:520px">
    <button style="position:absolute;top:14px;right:18px;background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--gray)" onclick="closeModal('overlayGuide')">âœ•</button>
    <h3 style="color:var(--primary);font-size:1.4rem;margin-bottom:6px">ğŸ‰ ChÃ o má»«ng Ä‘áº¿n StudyFlip!</h3>
    <p style="color:var(--gray);font-size:.88rem;margin-bottom:22px">Ã”n táº­p thÃ´ng minh hÆ¡n vá»›i flashcard â€” miá»…n phÃ­, khÃ´ng cáº§n Ä‘Äƒng nháº­p</p>

    <div style="display:flex;flex-direction:column;gap:16px;margin-bottom:18px">
      <div style="display:flex;gap:14px;align-items:flex-start">
        <div style="font-size:1.7rem;min-width:36px;text-align:center">ğŸ“š</div>
        <div>
          <div style="font-weight:700;margin-bottom:3px">Táº¡o bá»™ tháº» theo mÃ´n há»c</div>
          <div style="font-size:.82rem;color:var(--gray);line-height:1.5">Nháº¥n <b>"Táº¡o bá»™ tháº» má»›i"</b>, Ä‘áº·t tÃªn, chá»n mÃ´n há»c, mÃ u sáº¯c vÃ  icon yÃªu thÃ­ch.</div>
        </div>
      </div>
      <div style="display:flex;gap:14px;align-items:flex-start">
        <div style="font-size:1.7rem;min-width:36px;text-align:center">âœï¸</div>
        <div>
          <div style="font-weight:700;margin-bottom:3px">ThÃªm tháº» cÃ¢u há»i & Ä‘Ã¡p Ã¡n</div>
          <div style="font-size:.82rem;color:var(--gray);line-height:1.5">VÃ o <b>"Quáº£n lÃ½"</b> bá»™ tháº» â†’ nháº¥n <b>"+ ThÃªm tháº»"</b> â†’ nháº­p cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n.</div>
        </div>
      </div>
      <div style="display:flex;gap:14px;align-items:flex-start">
        <div style="font-size:1.7rem;min-width:36px;text-align:center">ğŸƒ</div>
        <div>
          <div style="font-weight:700;margin-bottom:3px">Há»c vá»›i flashcard láº­t 3D</div>
          <div style="font-size:.82rem;color:var(--gray);line-height:1.5">Nháº¥n <b>"â–¶ Há»c"</b> â†’ xem cÃ¢u há»i â†’ nháº¥n tháº» Ä‘á»ƒ láº­t xem Ä‘Ã¡p Ã¡n â†’ Ä‘Ã¡nh giÃ¡ má»©c Ä‘á»™ <b>Dá»… / BÃ¬nh thÆ°á»ng / KhÃ³</b>.</div>
        </div>
      </div>
      <div style="display:flex;gap:14px;align-items:flex-start">
        <div style="font-size:1.7rem;min-width:36px;text-align:center">ğŸ§ </div>
        <div>
          <div style="font-weight:700;margin-bottom:3px">Spaced Repetition thÃ´ng minh</div>
          <div style="font-size:.82rem;color:var(--gray);line-height:1.5">Há»‡ thá»‘ng tá»± Ä‘á»™ng tÃ­nh ngÃ y nháº¯c láº¡i: <b>Dá»…</b> â†’ 3 ngÃ y sau â€¢ <b>BÃ¬nh thÆ°á»ng</b> â†’ 1 ngÃ y sau â€¢ <b>KhÃ³</b> â†’ Ã´n láº¡i ngay hÃ´m sau.</div>
        </div>
      </div>
      <div style="display:flex;gap:14px;align-items:flex-start">
        <div style="font-size:1.7rem;min-width:36px;text-align:center">ğŸ¯</div>
        <div>
          <div style="font-weight:700;margin-bottom:3px">Thi thá»­ tráº¯c nghiá»‡m</div>
          <div style="font-size:.82rem;color:var(--gray);line-height:1.5">Sau khi há»c xong, nháº¥n <b>"Thi thá»­"</b> Ä‘á»ƒ kiá»ƒm tra vá»›i 4 Ä‘Ã¡p Ã¡n ngáº«u nhiÃªn. Cáº§n Ã­t nháº¥t <b>4 tháº»</b> Ä‘á»ƒ thi thá»­.</div>
        </div>
      </div>
    </div>

    <div style="background:#fff8e8;border-left:4px solid var(--warning);padding:12px 16px;border-radius:8px;margin-bottom:20px;font-size:.83rem;line-height:1.7">
      âš ï¸ <b>LÆ°u Ã½:</b><br>
      â€¢ Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u <b>ngay trÃªn trÃ¬nh duyá»‡t</b> cá»§a báº¡n, khÃ´ng máº¥t khi táº¯t tab<br>
      â€¢ Náº¿u xÃ³a lá»‹ch sá»­ trÃ¬nh duyá»‡t, dá»¯ liá»‡u cÃ³ thá»ƒ bá»‹ máº¥t â€” hÃ£y <b>khÃ´ng xÃ³a cache</b> thÆ°á»ng xuyÃªn<br>
      â€¢ NÃªn táº¡o Ã­t nháº¥t <b>4 tháº»</b> má»—i bá»™ Ä‘á»ƒ dÃ¹ng tÃ­nh nÄƒng thi thá»­
    </div>

    <button class="btn btn-primary" style="width:100%;padding:13px;font-size:1rem" onclick="closeModal('overlayGuide')">âœ… Báº¯t Ä‘áº§u há»c ngay!</button>
  </div>
</div>

<!-- HOME VIEW -->
<div class="view active" id="view-home">
  <div class="container">
    <div class="home-hero">
      <h1>Ã”n táº­p <span>thÃ´ng minh</span> hÆ¡n ğŸš€</h1>
      <p>Táº¡o flashcard theo mÃ´n há»c, há»‡ thá»‘ng tá»± nháº¯c láº¡i nhá»¯ng gÃ¬ báº¡n hay quÃªn!</p>
    </div>
    <div class="stats-bar" id="statsBar"></div>
    <div class="decks-header">
      <h2>ğŸ“š Bá»™ tháº» cá»§a tÃ´i</h2>
      <button class="btn btn-primary btn-sm" onclick="openAddDeck()">+ Táº¡o bá»™ tháº» má»›i</button>
    </div>
    <div class="decks-grid" id="decksGrid"></div>
  </div>
</div>

<!-- STUDY VIEW -->
<div class="view" id="view-study">
  <div class="container">
    <div class="study-header">
      <button class="btn btn-gray btn-sm" onclick="showView('home')">â† Quay láº¡i</button>
      <h2 id="studyDeckName"></h2>
      <span class="card-counter" id="cardCounter"></span>
    </div>
    <div class="progress-wrap"><div class="progress-fill" id="studyProgress" style="width:0%"></div></div>
    <div class="flip-scene" onclick="flipCard()">
      <div class="flip-card" id="flipCard">
        <div class="flip-face flip-front">
          <div class="flip-label">â“ CÃ¢u há»i</div>
          <div class="flip-text" id="cardQuestion"></div>
          <div class="flip-hint">Nháº¥n Ä‘á»ƒ xem Ä‘Ã¡p Ã¡n</div>
        </div>
        <div class="flip-face flip-back">
          <div class="flip-label">âœ… ÄÃ¡p Ã¡n</div>
          <div class="flip-text" id="cardAnswer"></div>
        </div>
      </div>
    </div>
    <div class="rating-btns" id="ratingBtns" style="display:none">
      <button class="rate-btn rate-hard" onclick="rateCard('hard')">ğŸ˜“ KhÃ³<small>Nháº¯c láº¡i sá»›m</small></button>
      <button class="rate-btn rate-medium" onclick="rateCard('medium')">ğŸ¤” BÃ¬nh thÆ°á»ng<small>Nháº¯c sau 1 ngÃ y</small></button>
      <button class="rate-btn rate-easy" onclick="rateCard('easy')">ğŸ˜„ Dá»…<small>Nháº¯c sau 3 ngÃ y</small></button>
    </div>
    <div class="study-actions">
      <button class="btn btn-gray btn-sm" onclick="prevCard()">â† TrÆ°á»›c</button>
      <button class="btn btn-primary btn-sm" onclick="flipCard()">ğŸ”„ Láº­t tháº»</button>
      <button class="btn btn-gray btn-sm" onclick="nextCard()">Tiáº¿p â†’</button>
    </div>
  </div>
</div>

<!-- RESULT VIEW -->
<div class="view" id="view-result">
  <div class="container">
    <div class="result-wrap">
      <div class="result-emoji" id="resultEmoji"></div>
      <h2 id="resultTitle"></h2>
      <p id="resultMsg"></p>
      <div class="result-stats">
        <div class="rs easy"><div class="n" id="resEasy">0</div><div class="l">ğŸ˜„ Dá»…</div></div>
        <div class="rs med"><div class="n" id="resMed">0</div><div class="l">ğŸ¤” BÃ¬nh thÆ°á»ng</div></div>
        <div class="rs hard"><div class="n" id="resHard">0</div><div class="l">ğŸ˜“ KhÃ³</div></div>
      </div>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <button class="btn btn-primary" onclick="startStudy(currentDeckId)">ğŸ”„ Há»c láº¡i</button>
        <button class="btn btn-gray" onclick="showView('home')">ğŸ  Trang chá»§</button>
        <button class="btn btn-warning" id="quizBtn" onclick="startQuiz()">ğŸ¯ Thi thá»­</button>
      </div>
    </div>
  </div>
</div>

<!-- QUIZ VIEW -->
<div class="view" id="view-quiz">
  <div class="container">
    <div class="study-header">
      <button class="btn btn-gray btn-sm" onclick="showView('home')">â† Quay láº¡i</button>
      <h2>ğŸ¯ Thi thá»­</h2>
      <span class="card-counter" id="quizCounter"></span>
    </div>
    <div class="progress-wrap"><div class="progress-fill" id="quizProgress" style="width:0%"></div></div>
    <div class="quiz-score" id="quizScore"></div>
    <div style="background:var(--white);border-radius:16px;padding:24px;box-shadow:var(--shadow);margin-bottom:20px">
      <p style="font-size:.8rem;color:var(--gray);font-weight:700;margin-bottom:10px">â“ CÃ‚U Há»I</p>
      <p style="font-size:1.1rem;font-weight:700" id="quizQuestion"></p>
    </div>
    <div id="quizOptions"></div>
    <div style="text-align:center;margin-top:10px">
      <button class="btn btn-primary" id="quizNextBtn" style="display:none" onclick="nextQuiz()">CÃ¢u tiáº¿p â†’</button>
    </div>
  </div>
</div>

<!-- MANAGE VIEW -->
<div class="view" id="view-manage">
  <div class="container">
    <div class="study-header">
      <button class="btn btn-gray btn-sm" onclick="showView('home')">â† Quay láº¡i</button>
      <h2 id="manageDeckName"></h2>
      <button class="btn btn-primary btn-sm" onclick="openAddCard()">+ ThÃªm tháº»</button>
    </div>
    <div class="search-wrap">
      <span class="ico">ğŸ”</span>
      <input type="text" placeholder="TÃ¬m kiáº¿m tháº»..." id="searchInput" oninput="renderCards()">
    </div>
    <div class="cards-list" id="cardsList"></div>
  </div>
</div>

<!-- MODALS -->
<div class="overlay" id="overlayAddDeck" style="display:none">
  <div class="modal">
    <h3 id="deckModalTitle">â• Táº¡o bá»™ tháº» má»›i</h3>
    <div class="form-group"><label>TÃªn bá»™ tháº»</label><input type="text" id="deckName" placeholder="VD: Sinh há»c lá»›p 11"></div>
    <div class="form-group"><label>MÃ´n há»c</label>
      <select id="deckSubject">
        <option>ToÃ¡n</option><option>Váº­t lÃ½</option><option>HÃ³a há»c</option>
        <option>Sinh há»c</option><option>Lá»‹ch sá»­</option><option>Äá»‹a lÃ½</option>
        <option>Tiáº¿ng Anh</option><option>Ngá»¯ vÄƒn</option><option>Tin há»c</option><option>KhÃ¡c</option>
      </select>
    </div>
    <div class="form-group"><label>MÃ u sáº¯c</label>
      <div class="color-picker">
        <div class="cp active" style="background:#6C63FF" data-color="#6C63FF" onclick="pickColor(this)"></div>
        <div class="cp" style="background:#FF6584" data-color="#FF6584" onclick="pickColor(this)"></div>
        <div class="cp" style="background:#43D9A2" data-color="#43D9A2" onclick="pickColor(this)"></div>
        <div class="cp" style="background:#FFB347" data-color="#FFB347" onclick="pickColor(this)"></div>
        <div class="cp" style="background:#4F8EF7" data-color="#4F8EF7" onclick="pickColor(this)"></div>
        <div class="cp" style="background:#a78bfa" data-color="#a78bfa" onclick="pickColor(this)"></div>
      </div>
    </div>
    <div class="form-group"><label>Icon</label>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ“š</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ”¬</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ§ª</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ§¬</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ“</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸŒ</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ—ºï¸</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ‡¬ğŸ‡§</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">âœï¸</span>
        <span style="cursor:pointer;font-size:1.5rem" onclick="pickIcon(this)">ğŸ’»</span>
      </div>
    </div>
    <div class="modal-btns">
      <button class="btn btn-gray" onclick="closeModal('overlayAddDeck')">Há»§y</button>
      <button class="btn btn-primary" onclick="saveDeck()">ğŸ’¾ LÆ°u</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlayAddCard" style="display:none">
  <div class="modal">
    <h3 id="cardModalTitle">â• ThÃªm tháº» má»›i</h3>
    <div class="form-group"><label>â“ CÃ¢u há»i / Máº·t trÆ°á»›c</label><textarea id="cardQ" placeholder="VD: Quang há»£p lÃ  gÃ¬?"></textarea></div>
    <div class="form-group"><label>âœ… ÄÃ¡p Ã¡n / Máº·t sau</label><textarea id="cardA" placeholder="VD: Quang há»£p lÃ  quÃ¡ trÃ¬nh..."></textarea></div>
    <div class="modal-btns">
      <button class="btn btn-gray" onclick="closeModal('overlayAddCard')">Há»§y</button>
      <button class="btn btn-primary" onclick="saveCard()">ğŸ’¾ LÆ°u tháº»</button>
    </div>
  </div>
</div>

<script>
// ============ DATA ============
let data = {decks:[], cards:[]};
let currentDeckId = null;
let studyQueue = [], studyIdx = 0, isFlipped = false;
let sessionRating = {easy:0, medium:0, hard:0};
let quizCards = [], quizIdx = 0, quizCorrect = 0;
let editingDeck = null, editingCard = null;
let selectedColor = '#6C63FF', selectedIcon = 'ğŸ“š';

function save() { localStorage.setItem('studyflip', JSON.stringify(data)); }
function load() {
  const d = localStorage.getItem('studyflip');
  if (d) data = JSON.parse(d);
  else {
    // Demo data
    const id = uid();
    data.decks.push({id, name:'Tiáº¿ng Anh cÆ¡ báº£n', subject:'Tiáº¿ng Anh', color:'#4F8EF7', icon:'ğŸ‡¬ğŸ‡§', created:Date.now()});
    data.cards.push(
      {id:uid(), deckId:id, q:'What does "photosynthesis" mean?', a:'Quang há»£p â€” quÃ¡ trÃ¬nh cÃ¢y xanh tá»•ng há»£p cháº¥t há»¯u cÆ¡ tá»« COâ‚‚ vÃ  nÆ°á»›c nhá» Ã¡nh sÃ¡ng', level:'new', nextReview:0},
      {id:uid(), deckId:id, q:'NghÄ©a cá»§a "perseverance" lÃ  gÃ¬?', a:'Sá»± kiÃªn trÃ¬, bá»n bá»‰ â€” tÃ­nh cháº¥t khÃ´ng bá» cuá»™c dÃ¹ gáº·p khÃ³ khÄƒn', level:'new', nextReview:0},
      {id:uid(), deckId:id, q:'"Ambiguous" cÃ³ nghÄ©a lÃ  gÃ¬?', a:'MÆ¡ há»“, khÃ´ng rÃµ rÃ ng â€” cÃ³ thá»ƒ hiá»ƒu theo nhiá»u cÃ¡ch khÃ¡c nhau', level:'new', nextReview:0}
    );
    save();
  }
}
function uid() { return Math.random().toString(36).slice(2,10); }
function openGuide() { document.getElementById('overlayGuide').style.display = 'flex'; }
function closeModal(id) { document.getElementById(id).style.display = 'none'; }

// ============ VIEWS ============
function showView(v) {
  document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
  document.getElementById('view-'+v).classList.add('active');
  if (v === 'home') renderHome();
  if (v === 'manage') renderCards();
}

// ============ HOME ============
function renderHome() {
  // Stats
  const total = data.cards.length;
  const due = data.cards.filter(c => c.nextReview <= Date.now()).length;
  const learned = data.cards.filter(c => c.level !== 'new').length;
  document.getElementById('statsBar').innerHTML = `
    <div class="stat-card"><div class="num">${data.decks.length}</div><div class="lbl">ğŸ“š Bá»™ tháº»</div></div>
    <div class="stat-card"><div class="num">${total}</div><div class="lbl">ğŸƒ Tá»•ng tháº»</div></div>
    <div class="stat-card"><div class="num" style="color:var(--danger)">${due}</div><div class="lbl">â° Cáº§n Ã´n hÃ´m nay</div></div>
  `;
  // Decks
  const g = document.getElementById('decksGrid');
  if (!data.decks.length) {
    g.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="big">ğŸ“­</div><p>ChÆ°a cÃ³ bá»™ tháº» nÃ o.<br>Nháº¥n <b>"Táº¡o bá»™ tháº» má»›i"</b> Ä‘á»ƒ báº¯t Ä‘áº§u!</p></div>`;
    return;
  }
  g.innerHTML = data.decks.map(deck => {
    const cards = data.cards.filter(c => c.deckId === deck.id);
    const dueN = cards.filter(c => c.nextReview <= Date.now()).length;
    const learnedN = cards.filter(c => c.level !== 'new').length;
    const pct = cards.length ? Math.round(learnedN/cards.length*100) : 0;
    return `<div class="deck-card" style="--deck-color:${deck.color}">
      <div class="deck-icon">${deck.icon}</div>
      <div class="deck-name">${deck.name}</div>
      <div class="deck-meta">${deck.subject} â€¢ ${cards.length} tháº»${dueN ? ` â€¢ <b style="color:var(--danger)">${dueN} cáº§n Ã´n</b>` : ''}</div>
      <div class="deck-progress"><div class="deck-progress-bar" style="width:${pct}%"></div></div>
      <div style="font-size:.75rem;color:var(--gray);margin-top:4px">${pct}% hoÃ n thÃ nh</div>
      <div class="deck-actions">
        <button class="btn btn-primary btn-sm" onclick="event.stopPropagation();startStudy('${deck.id}')">â–¶ Há»c</button>
        <button class="btn btn-warning btn-sm" onclick="event.stopPropagation();openManage('${deck.id}')">âœï¸ Quáº£n lÃ½</button>
        <button class="btn btn-danger btn-sm" onclick="event.stopPropagation();deleteDeck('${deck.id}')">ğŸ—‘</button>
      </div>
    </div>`;
  }).join('');
}

// ============ DECK CRUD ============
function openAddDeck() {
  editingDeck = null;
  document.getElementById('deckModalTitle').textContent = 'â• Táº¡o bá»™ tháº» má»›i';
  document.getElementById('deckName').value = '';
  selectedColor = '#6C63FF'; selectedIcon = 'ğŸ“š';
  document.querySelectorAll('.cp').forEach(c => c.classList.toggle('active', c.dataset.color === selectedColor));
  document.getElementById('overlayAddDeck').style.display = 'flex';
}
function pickColor(el) {
  document.querySelectorAll('.cp').forEach(c => c.classList.remove('active'));
  el.classList.add('active'); selectedColor = el.dataset.color;
}
function pickIcon(el) { selectedIcon = el.textContent; }
function saveDeck() {
  const name = document.getElementById('deckName').value.trim();
  const subject = document.getElementById('deckSubject').value;
  if (!name) { alert('Vui lÃ²ng nháº­p tÃªn bá»™ tháº»!'); return; }
  if (editingDeck) {
    const d = data.decks.find(d => d.id === editingDeck);
    d.name = name; d.subject = subject; d.color = selectedColor; d.icon = selectedIcon;
  } else {
    data.decks.push({id:uid(), name, subject, color:selectedColor, icon:selectedIcon, created:Date.now()});
  }
  save(); closeModal('overlayAddDeck'); renderHome();
}
function deleteDeck(id) {
  if (!confirm('XÃ³a bá»™ tháº» nÃ y? Táº¥t cáº£ tháº» bÃªn trong cÅ©ng sáº½ bá»‹ xÃ³a!')) return;
  data.decks = data.decks.filter(d => d.id !== id);
  data.cards = data.cards.filter(c => c.deckId !== id);
  save(); renderHome();
}

// ============ CARD CRUD ============
function openManage(deckId) {
  currentDeckId = deckId;
  const deck = data.decks.find(d => d.id === deckId);
  document.getElementById('manageDeckName').textContent = deck.icon + ' ' + deck.name;
  showView('manage');
}
function openAddCard() {
  editingCard = null;
  document.getElementById('cardModalTitle').textContent = 'â• ThÃªm tháº» má»›i';
  document.getElementById('cardQ').value = '';
  document.getElementById('cardA').value = '';
  document.getElementById('overlayAddCard').style.display = 'flex';
}
function openEditCard(id) {
  editingCard = id;
  const c = data.cards.find(c => c.id === id);
  document.getElementById('cardModalTitle').textContent = 'âœï¸ Sá»­a tháº»';
  document.getElementById('cardQ').value = c.q;
  document.getElementById('cardA').value = c.a;
  document.getElementById('overlayAddCard').style.display = 'flex';
}
function saveCard() {
  const q = document.getElementById('cardQ').value.trim();
  const a = document.getElementById('cardA').value.trim();
  if (!q || !a) { alert('Vui lÃ²ng nháº­p Ä‘á»§ cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n!'); return; }
  if (editingCard) {
    const c = data.cards.find(c => c.id === editingCard);
    c.q = q; c.a = a;
  } else {
    data.cards.push({id:uid(), deckId:currentDeckId, q, a, level:'new', nextReview:0});
  }
  save(); closeModal('overlayAddCard'); renderCards();
}
function deleteCard(id) {
  if (!confirm('XÃ³a tháº» nÃ y?')) return;
  data.cards = data.cards.filter(c => c.id !== id);
  save(); renderCards();
}
function renderCards() {
  const q = (document.getElementById('searchInput')?.value||'').toLowerCase();
  const cards = data.cards.filter(c => c.deckId === currentDeckId && (c.q.toLowerCase().includes(q) || c.a.toLowerCase().includes(q)));
  const badgeMap = {new:'badge-new', easy:'badge-easy', medium:'badge-medium', hard:'badge-hard'};
  const labelMap = {new:'Má»›i', easy:'Dá»…', medium:'BÃ¬nh thÆ°á»ng', hard:'KhÃ³'};
  document.getElementById('cardsList').innerHTML = cards.length
    ? cards.map(c => `<div class="card-item">
        <div class="ci-q">${c.q}</div>
        <div class="ci-a">${c.a}</div>
        <span class="ci-badge ${badgeMap[c.level]}">${labelMap[c.level]}</span>
        <button class="btn btn-gray btn-sm" onclick="openEditCard('${c.id}')">âœï¸</button>
        <button class="btn btn-danger btn-sm" onclick="deleteCard('${c.id}')">ğŸ—‘</button>
      </div>`).join('')
    : '<div class="empty-state"><div class="big">ğŸ“­</div><p>ChÆ°a cÃ³ tháº» nÃ o. Nháº¥n <b>"+ ThÃªm tháº»"</b>!</p></div>';
}

// ============ STUDY ============
function startStudy(deckId) {
  currentDeckId = deckId;
  const deck = data.decks.find(d => d.id === deckId);
  const cards = data.cards.filter(c => c.deckId === deckId);
  if (!cards.length) { alert('Bá»™ tháº» nÃ y chÆ°a cÃ³ tháº» nÃ o!'); return; }
  // Spaced repetition: Æ°u tiÃªn tháº» Ä‘áº¿n háº¡n, sau Ä‘Ã³ tháº» má»›i
  const due = cards.filter(c => c.nextReview <= Date.now());
  const newCards = cards.filter(c => c.level === 'new' && c.nextReview > Date.now());
  studyQueue = [...shuffle(due), ...shuffle(newCards)];
  if (!studyQueue.length) studyQueue = shuffle(cards);
  studyIdx = 0; isFlipped = false;
  sessionRating = {easy:0, medium:0, hard:0};
  document.getElementById('studyDeckName').textContent = deck.icon + ' ' + deck.name;
  showView('study');
  renderStudyCard();
}

function renderStudyCard() {
  if (studyIdx >= studyQueue.length) { showResult(); return; }
  const c = studyQueue[studyIdx];
  document.getElementById('cardQuestion').textContent = c.q;
  document.getElementById('cardAnswer').textContent = c.a;
  document.getElementById('cardCounter').textContent = `${studyIdx+1} / ${studyQueue.length}`;
  document.getElementById('studyProgress').style.width = `${(studyIdx/studyQueue.length)*100}%`;
  const fc = document.getElementById('flipCard');
  fc.classList.remove('flipped'); isFlipped = false;
  document.getElementById('ratingBtns').style.display = 'none';
}

function flipCard() {
  isFlipped = !isFlipped;
  document.getElementById('flipCard').classList.toggle('flipped', isFlipped);
  document.getElementById('ratingBtns').style.display = isFlipped ? 'flex' : 'none';
}

function rateCard(rating) {
  const c = studyQueue[studyIdx];
  const card = data.cards.find(x => x.id === c.id);
  card.level = rating;
  const days = rating === 'easy' ? 3 : rating === 'medium' ? 1 : 0.25;
  card.nextReview = Date.now() + days * 86400000;
  sessionRating[rating]++;
  save();
  studyIdx++;
  renderStudyCard();
}

function prevCard() { if (studyIdx > 0) { studyIdx--; renderStudyCard(); } }
function nextCard() { studyIdx++; renderStudyCard(); }

function showResult() {
  const total = studyQueue.length;
  const score = Math.round((sessionRating.easy * 100 + sessionRating.medium * 60) / total);
  document.getElementById('resEasy').textContent = sessionRating.easy;
  document.getElementById('resMed').textContent = sessionRating.medium;
  document.getElementById('resHard').textContent = sessionRating.hard;
  const emojis = score >= 80 ? 'ğŸ‰' : score >= 50 ? 'ğŸ‘' : 'ğŸ’ª';
  const titles = score >= 80 ? 'Xuáº¥t sáº¯c!' : score >= 50 ? 'Tá»‘t láº¯m!' : 'Cá»‘ lÃªn!';
  const msgs = score >= 80 ? 'Báº¡n Ä‘Ã£ náº¯m vá»¯ng pháº§n nÃ y rá»“i!' : score >= 50 ? 'Tiáº¿p tá»¥c Ã´n luyá»‡n nhÃ©!' : 'Äá»«ng náº£n lÃ²ng, Ã´n láº¡i nhÃ©!';
  document.getElementById('resultEmoji').textContent = emojis;
  document.getElementById('resultTitle').textContent = titles;
  document.getElementById('resultMsg').textContent = msgs;
  const cards = data.cards.filter(c => c.deckId === currentDeckId);
  document.getElementById('quizBtn').style.display = cards.length >= 4 ? 'inline-block' : 'none';
  showView('result');
}

// ============ QUIZ ============
function startQuiz() {
  const cards = data.cards.filter(c => c.deckId === currentDeckId);
  if (cards.length < 4) { alert('Cáº§n Ã­t nháº¥t 4 tháº» Ä‘á»ƒ thi thá»­!'); return; }
  quizCards = shuffle(cards);
  quizIdx = 0; quizCorrect = 0;
  showView('quiz');
  renderQuiz();
}

function renderQuiz() {
  if (quizIdx >= quizCards.length) { showQuizResult(); return; }
  const c = quizCards[quizIdx];
  const others = data.cards.filter(x => x.deckId === currentDeckId && x.id !== c.id);
  const wrong = shuffle(others).slice(0,3).map(x => x.a);
  const opts = shuffle([c.a, ...wrong]);
  document.getElementById('quizQuestion').textContent = c.q;
  document.getElementById('quizCounter').textContent = `${quizIdx+1} / ${quizCards.length}`;
  document.getElementById('quizProgress').style.width = `${(quizIdx/quizCards.length)*100}%`;
  document.getElementById('quizScore').textContent = `âœ… ÄÃºng: ${quizCorrect} / ${quizIdx}`;
  document.getElementById('quizNextBtn').style.display = 'none';
  document.getElementById('quizOptions').innerHTML = opts.map(o =>
    `<button class="quiz-option" onclick="selectQuiz(this,'${encodeURIComponent(o)}','${encodeURIComponent(c.a)}')">${o}</button>`
  ).join('');
}

function selectQuiz(btn, selected, correct) {
  const s = decodeURIComponent(selected), c = decodeURIComponent(correct);
  document.querySelectorAll('.quiz-option').forEach(b => b.disabled = true);
  document.querySelectorAll('.quiz-option').forEach(b => {
    if (decodeURIComponent(b.getAttribute('onclick').match(/'([^']+)'\)$/)?.[1]||'') === c) b.classList.add('correct');
  });
  if (s === c) { btn.classList.add('correct'); quizCorrect++; }
  else btn.classList.add('wrong');
  document.getElementById('quizNextBtn').style.display = 'inline-block';
}

function nextQuiz() { quizIdx++; renderQuiz(); }

function showQuizResult() {
  const pct = Math.round(quizCorrect/quizCards.length*100);
  const emoji = pct>=80?'ğŸ†':pct>=60?'ğŸ¯':'ğŸ“–';
  alert(`${emoji} Káº¿t quáº£ thi thá»­\n\nÄÃºng: ${quizCorrect}/${quizCards.length} (${pct}%)\n\n${pct>=80?'Xuáº¥t sáº¯c! ğŸ‰':pct>=60?'KhÃ¡ tá»‘t! Cá»‘ gáº¯ng thÃªm nhÃ©!':'Cáº§n Ã´n thÃªm nhÃ©!'}`);
  showView('result');
}

// ============ UTILS ============
function shuffle(arr) { return [...arr].sort(()=>Math.random()-.5); }

// Close modal on overlay click
document.querySelectorAll('.overlay').forEach(o => {
  o.addEventListener('click', e => { if (e.target === o) o.style.display = 'none'; });
});

// ============ INIT ============
load();
renderHome();
// Hiá»‡n hÆ°á»›ng dáº«n láº§n Ä‘áº§u truy cáº­p
if (!localStorage.getItem('studyflip_visited')) {
  openGuide();
  localStorage.setItem('studyflip_visited', '1');
}
</script>
</body>
</html>
